
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Wprowadzenie do biblioteki River &#8212; Przetwarzanie danych złożonych</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Wykrywanie dryftu konceptu" href="concept_drift.html" />
    <link rel="prev" title="Sieci - analiza i modelowanie" href="networks.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Przetwarzanie danych złożonych</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Przetwarzanie danych złożonych
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Laboratorium 1
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="zasady.html">
   Zasady
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Laboratorium 2
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="hawkes.html">
   Proces Hawkesa
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Laboratorium 3
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="exploratory_data_analysis.html">
   Analiza eksploracyjna danych
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Laboratorium 4
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="collective_classification.html">
   Klasyfikacja kolektywna
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Laboratorium 5
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="hierarchical_classification.html">
   Klasyfikacja hierarchiczna
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Laboratorium 6
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="networks.html">
   Sieci - analiza i modelowanie
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Laboratorium 7
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Wprowadzenie do biblioteki River
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Laboratorium 8
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="concept_drift.html">
   Wykrywanie dryftu konceptu
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Laboratorium 9
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="classification_of_streaming_data.html">
   Ewaluacja jednoklasowych algorytmów klasyfikacji w danych strumieniowych
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Laboratorium 10
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="time_series.html">
   Szeregi czasowe
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Laboratorium 11
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="time_series_neural_networks.html">
   Szeregi czasowe - sieci neuronowe
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/pwr-ai/przetwarzanie-danych-zlozonych/master?urlpath=tree/docs/labs/river_ml_introduction.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/labs/river_ml_introduction.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dane-w-bibliotece-river">
   Dane w bibliotece river
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tutorial">
   Tutorial
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#podstawowe-operacje-na-zbiorze-danych">
     Podstawowe operacje na zbiorze danych
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#wczytanie-zbioru-danych-dostepnego-w-bibliotece">
       Wczytanie zbioru danych dostępnego w bibliotece
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#dostep-do-elementow-zbioru">
       Dostęp do elementów zbioru
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#wczytanie-zbioru-z-pliku-csv">
       Wczytanie zbioru z pliku csv
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#przetwarzanie-zbioru-danych">
     Przetwarzanie zbioru danych
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rozklad-klas-liczony-od-na-calym-wczytanym-zbiorze">
       Rozkład klas liczony od na całym wczytanym zbiorze
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#obliczenie-rozkladu-klas-z-wykorzystaniem-podejscia-strumieniowego">
       Obliczenie rozkładu klas z wykorzystaniem podejścia strumieniowego
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#obliczenie-rozkladu-klas-z-wykorzystaniem-licznika-przyblizonego">
       Obliczenie rozkładu klas z wykorzystaniem licznika przybliżonego
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#porownanie-i-podsumowanie-dokladnosci-podejsc-obliczenia-rozkladu-klas">
       Porównanie i podsumowanie dokładności podejść obliczenia rozkładu klas
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transformacje-i-ekstrakcja-cech">
     Transformacje i ekstrakcja cech
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#przeksztalcenie-cech-timestamp-oraz-release-date-z-formatu-timestamp-do-formatu-datetime">
       Przekształcenie cech
       <code class="docutils literal notranslate">
        <span class="pre">
         timestamp
        </span>
       </code>
       oraz
       <code class="docutils literal notranslate">
        <span class="pre">
         release_date
        </span>
       </code>
       z formatu
       <code class="docutils literal notranslate">
        <span class="pre">
         timestamp
        </span>
       </code>
       do formatu
       <code class="docutils literal notranslate">
        <span class="pre">
         datetime
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#kompozycja-transformacji-w-jedna">
       Kompozycja transformacji w jedną
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modelowanie-tematyczne-tytulow-filmow-za-pomoca-algorytmu-lda">
       Modelowanie tematyczne tytułów filmów za pomocą algorytmu
       <code class="docutils literal notranslate">
        <span class="pre">
         LDA
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tworzenie-sekwencji-krokow-przetwarzania-za-pomoca-klasy-pipeline">
       Tworzenie sekwencji kroków przetwarzania za pomocą klasy
       <code class="docutils literal notranslate">
        <span class="pre">
         Pipeline
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#agregacje-cech-z-perspektywy-danego-uzytkownika">
       Agregacje cech z perspektywy danego użytkownika
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Wprowadzenie do biblioteki River</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dane-w-bibliotece-river">
   Dane w bibliotece river
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tutorial">
   Tutorial
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#podstawowe-operacje-na-zbiorze-danych">
     Podstawowe operacje na zbiorze danych
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#wczytanie-zbioru-danych-dostepnego-w-bibliotece">
       Wczytanie zbioru danych dostępnego w bibliotece
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#dostep-do-elementow-zbioru">
       Dostęp do elementów zbioru
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#wczytanie-zbioru-z-pliku-csv">
       Wczytanie zbioru z pliku csv
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#przetwarzanie-zbioru-danych">
     Przetwarzanie zbioru danych
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rozklad-klas-liczony-od-na-calym-wczytanym-zbiorze">
       Rozkład klas liczony od na całym wczytanym zbiorze
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#obliczenie-rozkladu-klas-z-wykorzystaniem-podejscia-strumieniowego">
       Obliczenie rozkładu klas z wykorzystaniem podejścia strumieniowego
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#obliczenie-rozkladu-klas-z-wykorzystaniem-licznika-przyblizonego">
       Obliczenie rozkładu klas z wykorzystaniem licznika przybliżonego
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#porownanie-i-podsumowanie-dokladnosci-podejsc-obliczenia-rozkladu-klas">
       Porównanie i podsumowanie dokładności podejść obliczenia rozkładu klas
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transformacje-i-ekstrakcja-cech">
     Transformacje i ekstrakcja cech
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#przeksztalcenie-cech-timestamp-oraz-release-date-z-formatu-timestamp-do-formatu-datetime">
       Przekształcenie cech
       <code class="docutils literal notranslate">
        <span class="pre">
         timestamp
        </span>
       </code>
       oraz
       <code class="docutils literal notranslate">
        <span class="pre">
         release_date
        </span>
       </code>
       z formatu
       <code class="docutils literal notranslate">
        <span class="pre">
         timestamp
        </span>
       </code>
       do formatu
       <code class="docutils literal notranslate">
        <span class="pre">
         datetime
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#kompozycja-transformacji-w-jedna">
       Kompozycja transformacji w jedną
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modelowanie-tematyczne-tytulow-filmow-za-pomoca-algorytmu-lda">
       Modelowanie tematyczne tytułów filmów za pomocą algorytmu
       <code class="docutils literal notranslate">
        <span class="pre">
         LDA
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tworzenie-sekwencji-krokow-przetwarzania-za-pomoca-klasy-pipeline">
       Tworzenie sekwencji kroków przetwarzania za pomocą klasy
       <code class="docutils literal notranslate">
        <span class="pre">
         Pipeline
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#agregacje-cech-z-perspektywy-danego-uzytkownika">
       Agregacje cech z perspektywy danego użytkownika
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="wprowadzenie-do-biblioteki-river">
<h1>Wprowadzenie do biblioteki River<a class="headerlink" href="#wprowadzenie-do-biblioteki-river" title="Permalink to this headline">#</a></h1>
<p><a class="reference external" href="https://github.com/online-ml/river">River</a> jest jedną z najbardziej rozszerzonych bibliotek z dziedziny online machine learning. Jest wynikiem połączenia dwóch bibliotek <a class="reference external" href="https://github.com/MaxHalford/creme">creme</a> oraz <a class="reference external" href="https://github.com/scikit-multiflow/scikit-multiflow">scikit-multiflow</a>. Jest głównie napisana w języku Python, przy czym intensywne obliczeniowo operacje napisane są w języku Rust.</p>
<p>Główna funkcjonalność biblioteki obejmuje <a class="reference external" href="http://m.in">m.in</a>.:</p>
<ul class="simple">
<li><p>Modele liniowe i klasyczne modele maszynowego uczenia</p></li>
<li><p>Wykrywanie anomalii i dryftu konceptu</p></li>
<li><p>Systemy rekomendycjne</p></li>
<li><p>Prognozowanie na podstawie szeregów czasowych</p></li>
<li><p>Uczenie niezbalansowanych danych</p></li>
<li><p>Klasteryzacja</p></li>
<li><p>Metryki i statystyki zadaptowane do dziedziny Online Machine Learning</p></li>
</ul>
<p>Najważniejsze linki:</p>
<ul class="simple">
<li><p>Strona główna <a class="reference external" href="https://riverml.xyz/0.14.0/">[LINK]</a></p></li>
<li><p>Tutoriale <a class="reference external" href="https://riverml.xyz/0.14.0/recipes/reading-data/">[LINK]</a></p></li>
<li><p>Przykłady <a class="reference external" href="https://riverml.xyz/0.14.0/examples/batch-to-online/">[LINK]</a></p></li>
<li><p>Dokumentacja <a class="reference external" href="https://riverml.xyz/0.14.0/api/overview/">[LINK]</a></p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Materiały wraz z tutorialami zostały przygotowane w oparciu o biblioteke <code class="docutils literal notranslate"><span class="pre">river</span></code> w wersji 0.14</p>
</div>
<section id="dane-w-bibliotece-river">
<h2>Dane w bibliotece river<a class="headerlink" href="#dane-w-bibliotece-river" title="Permalink to this headline">#</a></h2>
<p>Dodatkowo, w bibliotce <code class="docutils literal notranslate"><span class="pre">river</span></code> zawarto pakiet zbiorów z dziedziny online machine learning wraz z potrzebnymi loaderami.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Pełną listę zbiorów można przejrzeć na stronie biblioteki <a class="reference external" href="https://riverml.xyz/0.14.0/api/datasets/AirlinePassengers/">[LINK]</a></p>
</div>
<p>Funkcjanolność biblioteki nie ogranicza się tylko do udostępnionych zbiorów. W bibliotece znajdziemy obsługę wielu popularnych formatów danych takich jak np. numpy array, pliki csv czy bezpośrednie pobieranie danych z baz sql.</p>
<p>Pełne przedstawienie formatów danych wspierających przez bibliotekę <code class="docutils literal notranslate"><span class="pre">river</span></code> przedstawiono w poniższej tabeli:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Format danych</p></th>
<th class="head"><p>Loader</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>arff</p></td>
<td><p><a class="reference external" href="https://riverml.xyz/0.14.0/api/stream/iter-arff/">stream.iter_arff</a></p></td>
</tr>
<tr class="row-odd"><td><p>numpy array</p></td>
<td><p><a class="reference external" href="https://riverml.xyz/0.14.0/api/stream/iter-array/">stream.iter_array</a></p></td>
</tr>
<tr class="row-even"><td><p>csv</p></td>
<td><p><a class="reference external" href="https://riverml.xyz/0.14.0/api/stream/iter-csv/">stream.iter_csv</a></p></td>
</tr>
<tr class="row-odd"><td><p>LIBSVM</p></td>
<td><p><a class="reference external" href="https://riverml.xyz/0.14.0/api/stream/iter-libsvm/">stream.iter_libsvm</a></p></td>
</tr>
<tr class="row-even"><td><p>pandas DataFrame</p></td>
<td><p><a class="reference external" href="https://riverml.xyz/0.14.0/api/stream/iter-pandas/">stream.iter_pandas</a></p></td>
</tr>
<tr class="row-odd"><td><p>sklearn dataset</p></td>
<td><p><a class="reference external" href="https://riverml.xyz/0.14.0/api/stream/iter-sklearn-dataset/">stream.iter_sklearn_dataset</a></p></td>
</tr>
<tr class="row-even"><td><p>sql</p></td>
<td><p><a class="reference external" href="https://riverml.xyz/0.14.0/api/stream/iter-sql/">stream.iter_sql</a></p></td>
</tr>
<tr class="row-odd"><td><p>vaex DataFrame</p></td>
<td><p><a class="reference external" href="https://riverml.xyz/0.14.0/api/stream/iter-vaex/">stream.iter_vaex</a></p></td>
</tr>
</tbody>
</table>
</section>
<section id="tutorial">
<h2>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">#</a></h2>
<p>W tutorialu wykorzystano zbiór danych <a class="reference external" href="https://grouplens.org/datasets/movielens/100k/"><code class="docutils literal notranslate"><span class="pre">MovieLens100K</span></code></a>. Jest to zbiór danych przygotowany przez naukowców z University of Minnesota. Składa się z 100 000 ocen w skali 1-5 1682 filmów pochodzących od 943 użytkowników.</p>
<section id="podstawowe-operacje-na-zbiorze-danych">
<h3>Podstawowe operacje na zbiorze danych<a class="headerlink" href="#podstawowe-operacje-na-zbiorze-danych" title="Permalink to this headline">#</a></h3>
<section id="wczytanie-zbioru-danych-dostepnego-w-bibliotece">
<h4>Wczytanie zbioru danych dostępnego w bibliotece<a class="headerlink" href="#wczytanie-zbioru-danych-dostepnego-w-bibliotece" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">river.datasets</span> <span class="kn">import</span> <span class="n">MovieLens100K</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">MovieLens100K</span><span class="p">()</span>
<span class="n">ds</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MovieLens 100K dataset.

MovieLens datasets were collected by the GroupLens Research Project at the University of
Minnesota. This dataset consists of 100,000 ratings (1-5) from 943 users on 1682 movies. Each
user has rated at least 20 movies. User and movie information are provided. The data was
collected through the MovieLens web site (movielens.umn.edu) during the seven-month period from
September 19th, 1997 through April 22nd, 1998.

      Name  MovieLens100K                                            
      Task  Regression                                               
   Samples  100,000                                                  
  Features  10                                                       
    Sparse  False                                                    
      Path  /Users/kamiltagowski/river_data/MovieLens100K/ml_100k.csv
       URL  https://maxhalford.github.io/files/datasets/ml_100k.zip  
      Size  10.55 MB                                                 
Downloaded  True                                                     

Parameters
----------
    unpack_user_and_item
        Whether or not the user and item should be extracted from the context and included as extra
        keyword arguments.
</pre></div>
</div>
</div>
</div>
</section>
<section id="dostep-do-elementow-zbioru">
<h4>Dostęp do elementów zbioru<a class="headerlink" href="#dostep-do-elementow-zbioru" title="Permalink to this headline">#</a></h4>
<p>Standardowy dostęp do elementów ze zbioru danych odbywa się za pomocą iteratora.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">ds</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>({&#39;user&#39;: &#39;259&#39;,
  &#39;item&#39;: &#39;255&#39;,
  &#39;timestamp&#39;: 874731910000000000,
  &#39;title&#39;: &quot;My Best Friend&#39;s Wedding (1997)&quot;,
  &#39;release_date&#39;: 866764800000000000,
  &#39;genres&#39;: &#39;comedy, romance&#39;,
  &#39;age&#39;: 21.0,
  &#39;gender&#39;: &#39;M&#39;,
  &#39;occupation&#39;: &#39;student&#39;,
  &#39;zip_code&#39;: &#39;48823&#39;},
 4.0)
</pre></div>
</div>
</div>
</div>
<p>W przypadku wykorzystania pętli, nie ma potrzeby tworzenia wcześniej iteratora.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>W celu przejrzystego wyświetlania danych została wykorzystana metoda <a class="reference external" href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.display.html#IPython.display.display_pretty"><code class="docutils literal notranslate"><span class="pre">display_pretty</span></code></a> z modułu <code class="docutils literal notranslate"><span class="pre">IPython.display</span></code></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display_pretty</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">display_pretty</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;user&#39;: &#39;259&#39;,
 &#39;item&#39;: &#39;255&#39;,
 &#39;timestamp&#39;: 874731910000000000,
 &#39;title&#39;: &quot;My Best Friend&#39;s Wedding (1997)&quot;,
 &#39;release_date&#39;: 866764800000000000,
 &#39;genres&#39;: &#39;comedy, romance&#39;,
 &#39;age&#39;: 21.0,
 &#39;gender&#39;: &#39;M&#39;,
 &#39;occupation&#39;: &#39;student&#39;,
 &#39;zip_code&#39;: &#39;48823&#39;}
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.0
</pre></div>
</div>
</div>
</div>
<p>W przypadku zbiorów danych udostępnionych przez bibliotekę, do dyspozycji mamy również metodę <a class="reference external" href="https://riverml.xyz/0.14.0/api/datasets/base/Dataset/"><code class="docutils literal notranslate"><span class="pre">take</span></code></a>, która zwraca iterator na n pierwszych elementów</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[({&#39;user&#39;: &#39;259&#39;,
   &#39;item&#39;: &#39;255&#39;,
   &#39;timestamp&#39;: 874731910000000000,
   &#39;title&#39;: &quot;My Best Friend&#39;s Wedding (1997)&quot;,
   &#39;release_date&#39;: 866764800000000000,
   &#39;genres&#39;: &#39;comedy, romance&#39;,
   &#39;age&#39;: 21.0,
   &#39;gender&#39;: &#39;M&#39;,
   &#39;occupation&#39;: &#39;student&#39;,
   &#39;zip_code&#39;: &#39;48823&#39;},
  4.0),
 ({&#39;user&#39;: &#39;259&#39;,
   &#39;item&#39;: &#39;286&#39;,
   &#39;timestamp&#39;: 874731927000000000,
   &#39;title&#39;: &#39;English Patient, The (1996)&#39;,
   &#39;release_date&#39;: 848016000000000000,
   &#39;genres&#39;: &#39;drama, romance, war&#39;,
   &#39;age&#39;: 21.0,
   &#39;gender&#39;: &#39;M&#39;,
   &#39;occupation&#39;: &#39;student&#39;,
   &#39;zip_code&#39;: &#39;48823&#39;},
  4.0)]
</pre></div>
</div>
</div>
</div>
</section>
<section id="wczytanie-zbioru-z-pliku-csv">
<h4>Wczytanie zbioru z pliku csv<a class="headerlink" href="#wczytanie-zbioru-z-pliku-csv" title="Permalink to this headline">#</a></h4>
<p>W celach ćwiczenia wczytamy zbiór danych bezpośrednio z pliku <code class="docutils literal notranslate"><span class="pre">csv</span></code>, ale wykorzystamy już wersję zbioru pobraną wcześniej. Aby dostać się do ścieżki pobranego zbioru odwołamy się do pola <code class="docutils literal notranslate"><span class="pre">path</span></code> z utworzonego wcześniej obiektu zbioru.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">path</span>
<span class="n">path</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PosixPath(&#39;/Users/kamiltagowski/river_data/MovieLens100K/ml_100k.csv&#39;)
</pre></div>
</div>
</div>
</div>
<p>Do stworzenia iteratora z pliku skorzystamy z metody <a class="reference external" href="https://riverml.xyz/0.14.0/api/stream/iter-csv/"><code class="docutils literal notranslate"><span class="pre">iter_csv</span></code></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">river.stream</span> <span class="kn">import</span> <span class="n">iter_csv</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">iter_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">display_pretty</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;user&#39;: &#39;259&#39;,
 &#39;item&#39;: &#39;255&#39;,
 &#39;rating&#39;: &#39;4.0&#39;,
 &#39;timestamp&#39;: &#39;874731910000000000&#39;,
 &#39;title&#39;: &quot;My Best Friend&#39;s Wedding (1997)&quot;,
 &#39;release_date&#39;: &#39;866764800000000000&#39;,
 &#39;genres&#39;: &#39;comedy, romance&#39;,
 &#39;age&#39;: &#39;21&#39;,
 &#39;gender&#39;: &#39;M&#39;,
 &#39;occupation&#39;: &#39;student&#39;,
 &#39;zip_code&#39;: &#39;48823&#39;}
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>None
</pre></div>
</div>
</div>
</div>
<p>W porównaniu do poprzednego formatu możemy zauważyć nieporządane właściowości:</p>
<ul class="simple">
<li><p>Wszystkie cechy wczytane są jako obiekty <code class="docutils literal notranslate"><span class="pre">string</span></code></p></li>
<li><p>Cecha wyjściowa nie jest ustawiona, w razultacie otrzymujemy obiekt <code class="docutils literal notranslate"><span class="pre">None</span></code></p></li>
</ul>
<p>Aby to poprawić, musimy zdefiniować dodatkowe argumenty, przekazane do metody <code class="docutils literal notranslate"><span class="pre">iter_csv</span></code>:</p>
<ul class="simple">
<li><p>Mapowanie pól danych przekozujemy poprzez ustawienie parametru <code class="docutils literal notranslate"><span class="pre">converters</span></code></p></li>
<li><p>Zdefiniowanie cechy wyjśćiowowej za pomocą parametru <code class="docutils literal notranslate"><span class="pre">target</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">river.stream</span> <span class="kn">import</span> <span class="n">iter_csv</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">iter_csv</span><span class="p">(</span>
    <span class="n">path</span><span class="p">,</span>
    <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="s2">&quot;rating&quot;</span><span class="p">,</span>
    <span class="n">converters</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;release_date&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">display_pretty</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;user&#39;: &#39;259&#39;,
 &#39;item&#39;: &#39;255&#39;,
 &#39;timestamp&#39;: 874731910000000000,
 &#39;title&#39;: &quot;My Best Friend&#39;s Wedding (1997)&quot;,
 &#39;release_date&#39;: 866764800000000000,
 &#39;genres&#39;: &#39;comedy, romance&#39;,
 &#39;age&#39;: 21,
 &#39;gender&#39;: &#39;M&#39;,
 &#39;occupation&#39;: &#39;student&#39;,
 &#39;zip_code&#39;: &#39;48823&#39;}
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.0
</pre></div>
</div>
</div>
</div>
<p>Częściowo możemy to obejść poprzez wykorzystanie biblioteki <code class="docutils literal notranslate"><span class="pre">pandas</span></code> i metody <a class="reference external" href="https://riverml.xyz/0.11.1/api/stream/iter-pandas/"><code class="docutils literal notranslate"><span class="pre">iter_pandas</span></code></a>. Pola danych zostaną automatycznie zmapowane za wyjątkiem zmiennej wyjściowej.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">river.stream</span> <span class="kn">import</span> <span class="n">iter_pandas</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;rating&quot;</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">iter_pandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">display_pretty</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;user&#39;: 259,
 &#39;item&#39;: 255,
 &#39;timestamp&#39;: 874731910000000000,
 &#39;title&#39;: &quot;My Best Friend&#39;s Wedding (1997)&quot;,
 &#39;release_date&#39;: 866764800000000000,
 &#39;genres&#39;: &#39;comedy, romance&#39;,
 &#39;age&#39;: 21,
 &#39;gender&#39;: &#39;M&#39;,
 &#39;occupation&#39;: &#39;student&#39;,
 &#39;zip_code&#39;: &#39;48823&#39;}
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.0
</pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Trzeba mieć na uwadze, że takie rozwiązanie nie jest w pełni podejściem <code class="docutils literal notranslate"><span class="pre">online</span></code>, ponieważ plik zostanie najpierw wczytany w całości. Rozwiązanie może być natomiast przydatne w trakcie eksperymentowania.</p>
</div>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Pomimo tego, że rozwiązania na pierwszy rzut oka wyglądają identycznie, tak na prawdę różnią się.
Dlaczego? Pandas uzupełni brakujące wartości jako <code class="docutils literal notranslate"><span class="pre">nan</span></code>, który jest type float.</p>
</div>
<p>Sprawdźmy brakujące wartości</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>909
</pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Łącznie w całym zbiorze mamy 909 rekordów z co najmniej jedną brakującą wartością.</p>
</div>
<p>Sprawdźmy teraz dla jakich kolumn występowały brakujące wartości</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user            False
item            False
timestamp       False
title            True
release_date    False
genres          False
age             False
gender          False
occupation       True
zip_code        False
dtype: bool
</pre></div>
</div>
</div>
</div>
<p>Wartości brakujące występowały wyłącznie dla zmiennych tekstowych <code class="docutils literal notranslate"><span class="pre">title</span></code> oraz <code class="docutils literal notranslate"><span class="pre">occupation</span></code>
W takim razie wystarczy wykorzystać metodę <code class="docutils literal notranslate"><span class="pre">fillna(str)</span></code>, aby mieć domyślne zachowanie.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Metoda <code class="docutils literal notranslate"><span class="pre">fillna()</span></code> powinna być jednak wykorzystana z rozwagą. Dodatkowe sprawdzenia były celowe, ponieważ jeżeli brakujące wartości pojawiły się w polach liczbowych pandas uzupełniłby je wartościami pustymi typu <code class="docutils literal notranslate"><span class="pre">str</span></code>.</p>
</div>
</section>
</section>
<section id="przetwarzanie-zbioru-danych">
<h3>Przetwarzanie zbioru danych<a class="headerlink" href="#przetwarzanie-zbioru-danych" title="Permalink to this headline">#</a></h3>
<section id="rozklad-klas-liczony-od-na-calym-wczytanym-zbiorze">
<h4>Rozkład klas liczony od na całym wczytanym zbiorze<a class="headerlink" href="#rozklad-klas-liczony-od-na-calym-wczytanym-zbiorze" title="Permalink to this headline">#</a></h4>
<p>Zacznijmy od zbadania rozkładu klas. Zacznijmy od scenariusza, gdzie mamy dostęp do wczytanego pełnego zbioru (wykonanego za pomocą biblioteki <code class="docutils literal notranslate"><span class="pre">pandas</span></code>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">counter</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">x</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">counter</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">errorbar</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/river_ml_introduction_38_0.png" src="../_images/river_ml_introduction_38_0.png" />
</div>
</div>
</section>
<section id="obliczenie-rozkladu-klas-z-wykorzystaniem-podejscia-strumieniowego">
<h4>Obliczenie rozkładu klas z wykorzystaniem podejścia strumieniowego<a class="headerlink" href="#obliczenie-rozkladu-klas-z-wykorzystaniem-podejscia-strumieniowego" title="Permalink to this headline">#</a></h4>
<p>W bibliotece river możemy również obliczać statystyki w podejściu strumieniowym, czego przykładem jest <a class="reference external" href="https://riverml.xyz/0.14.0/api/sketch/Histogram/"><code class="docutils literal notranslate"><span class="pre">Histogram</span></code></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">river.sketch</span> <span class="kn">import</span> <span class="n">Histogram</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">iter_pandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
<span class="n">hist</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span><span class="n">max_bins</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">count</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">hist</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">left</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">hist</span><span class="p">],</span> <span class="n">errorbar</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/river_ml_introduction_40_0.png" src="../_images/river_ml_introduction_40_0.png" />
</div>
</div>
</section>
<section id="obliczenie-rozkladu-klas-z-wykorzystaniem-licznika-przyblizonego">
<h4>Obliczenie rozkładu klas z wykorzystaniem licznika przybliżonego<a class="headerlink" href="#obliczenie-rozkladu-klas-z-wykorzystaniem-licznika-przyblizonego" title="Permalink to this headline">#</a></h4>
<p>Często jednak wartości cech mogą nie mieć zdefiniowanego zakresu, ale pochodzić z całego zbioru liczb rzeczywistych. Obliczenie histogramu dla takich cech, może być zbyt kosztowne obliczeniowo. W takiej sytuacji możemy skorzystać z przybliżonego obliczenia wartości. W tym celu wykorzystamy klasę <a class="reference external" href="https://riverml.xyz/0.14.0/api/sketch/Counter/">Counter</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">river.sketch</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="n">cms</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">441</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">iter_pandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
<span class="n">values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">cms</span> <span class="o">=</span> <span class="n">cms</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="n">values</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Obliczanie przybliżone licznika wystąpień poszczególnych wartości dla cech z ograniczonym podzbiorem, jakim jest cecha wyjściowa zbioru MovieLens100K może nie mieć uzsadnienia. Warto jednak pamiętać o takim rozwiązaniu przy cechach z dużą liczbą unikatowych wartości.</p>
</div>
</section>
<section id="porownanie-i-podsumowanie-dokladnosci-podejsc-obliczenia-rozkladu-klas">
<h4>Porównanie i podsumowanie dokładności podejść obliczenia rozkładu klas<a class="headerlink" href="#porownanie-i-podsumowanie-dokladnosci-podejsc-obliczenia-rozkladu-klas" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">summary</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">rating</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;Counter&quot;</span><span class="p">:</span> <span class="n">counter</span><span class="p">[</span><span class="n">rating</span><span class="p">],</span>
            <span class="s2">&quot;Counter (approx. version)&quot;</span><span class="p">:</span> <span class="n">cms</span><span class="p">[</span><span class="n">rating</span><span class="p">],</span>
            <span class="s2">&quot;Histogram (streaming version)&quot;</span><span class="p">:</span> <span class="n">hist</span><span class="p">[</span><span class="n">rating</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Counter</th>
      <th>Counter (approx. version)</th>
      <th>Histogram (streaming version)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>6110</td>
      <td>6110</td>
      <td>6110</td>
    </tr>
    <tr>
      <th>2</th>
      <td>11370</td>
      <td>11370</td>
      <td>11370</td>
    </tr>
    <tr>
      <th>3</th>
      <td>27145</td>
      <td>27145</td>
      <td>27145</td>
    </tr>
    <tr>
      <th>4</th>
      <td>34174</td>
      <td>34174</td>
      <td>34174</td>
    </tr>
    <tr>
      <th>5</th>
      <td>21201</td>
      <td>21201</td>
      <td>21201</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>W testowanym scenariuszu podejścia mają identyczne wyniki. Wynika to z ograniczonego rozmiaru zbioru (przyp. tylko 100K przypadków) oraz ograniczanego zakresu wartości całkowitych &lt;1,5&gt;.</p>
</section>
</section>
<section id="transformacje-i-ekstrakcja-cech">
<h3>Transformacje i ekstrakcja cech<a class="headerlink" href="#transformacje-i-ekstrakcja-cech" title="Permalink to this headline">#</a></h3>
<p>W tym podrozdziale omówimy podstawowe transformacje cech z wykorzystaniem river.</p>
<p>Przypomnijmy jakie cechy znajdują się w zbiorze danych</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>item</th>
      <th>rating</th>
      <th>timestamp</th>
      <th>title</th>
      <th>release_date</th>
      <th>genres</th>
      <th>age</th>
      <th>gender</th>
      <th>occupation</th>
      <th>zip_code</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>259</td>
      <td>255</td>
      <td>4.0</td>
      <td>874731910000000000</td>
      <td>My Best Friend's Wedding (1997)</td>
      <td>866764800000000000</td>
      <td>comedy, romance</td>
      <td>21</td>
      <td>M</td>
      <td>student</td>
      <td>48823</td>
    </tr>
    <tr>
      <th>1</th>
      <td>259</td>
      <td>286</td>
      <td>4.0</td>
      <td>874731927000000000</td>
      <td>English Patient, The (1996)</td>
      <td>848016000000000000</td>
      <td>drama, romance, war</td>
      <td>21</td>
      <td>M</td>
      <td>student</td>
      <td>48823</td>
    </tr>
    <tr>
      <th>2</th>
      <td>259</td>
      <td>298</td>
      <td>4.0</td>
      <td>874731954000000000</td>
      <td>Face/Off (1997)</td>
      <td>867369600000000000</td>
      <td>action, sci_fi, thriller</td>
      <td>21</td>
      <td>M</td>
      <td>student</td>
      <td>48823</td>
    </tr>
    <tr>
      <th>3</th>
      <td>259</td>
      <td>185</td>
      <td>4.0</td>
      <td>874731981000000000</td>
      <td>Psycho (1960)</td>
      <td>-315619200000000000</td>
      <td>horror, romance, thriller</td>
      <td>21</td>
      <td>M</td>
      <td>student</td>
      <td>48823</td>
    </tr>
    <tr>
      <th>4</th>
      <td>259</td>
      <td>173</td>
      <td>4.0</td>
      <td>874732043000000000</td>
      <td>Princess Bride, The (1987)</td>
      <td>536457600000000000</td>
      <td>action, adventure, comedy, romance</td>
      <td>21</td>
      <td>M</td>
      <td>student</td>
      <td>48823</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>W ramach materiału wykonamy poniższych przekształceń:</p>
<ul class="simple">
<li><p>Przekształcenie cech <code class="docutils literal notranslate"><span class="pre">timestamp</span></code> oraz <code class="docutils literal notranslate"><span class="pre">release_date</span></code>  z formatu <code class="docutils literal notranslate"><span class="pre">timestamp</span></code> do formatu <code class="docutils literal notranslate"><span class="pre">datetime</span></code></p></li>
<li><p>Kompozycja cech</p></li>
<li><p>Modelowanie tematyczne tytułów filmów za pomocą algorytmu <code class="docutils literal notranslate"><span class="pre">LDA</span></code></p></li>
<li><p>Tworzenie sekwencji kroków przetwarzania za pomocą klasy <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code></p></li>
<li><p>Agregacje cech z perspektywy danego użytkownika</p></li>
</ul>
<section id="przeksztalcenie-cech-timestamp-oraz-release-date-z-formatu-timestamp-do-formatu-datetime">
<h4>Przekształcenie cech <code class="docutils literal notranslate"><span class="pre">timestamp</span></code> oraz <code class="docutils literal notranslate"><span class="pre">release_date</span></code>  z formatu <code class="docutils literal notranslate"><span class="pre">timestamp</span></code> do formatu <code class="docutils literal notranslate"><span class="pre">datetime</span></code><a class="headerlink" href="#przeksztalcenie-cech-timestamp-oraz-release-date-z-formatu-timestamp-do-formatu-datetime" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">iter_pandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">date_column</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;release_date&quot;</span><span class="p">):</span>
        <span class="n">x</span><span class="p">[</span><span class="n">date_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">date_column</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e9</span><span class="p">)</span>
    
    <span class="c1"># `break` i `display_pretty` tylko w celach wyświetlenia pojedynczego rekordu</span>
    <span class="n">display_pretty</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">break</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;user&#39;: 259,
 &#39;item&#39;: 255,
 &#39;rating&#39;: 4.0,
 &#39;timestamp&#39;: datetime.datetime(1997, 9, 20, 7, 5, 10),
 &#39;title&#39;: &quot;My Best Friend&#39;s Wedding (1997)&quot;,
 &#39;release_date&#39;: datetime.datetime(1997, 6, 20, 2, 0),
 &#39;genres&#39;: &#39;comedy, romance&#39;,
 &#39;age&#39;: 21,
 &#39;gender&#39;: &#39;M&#39;,
 &#39;occupation&#39;: &#39;student&#39;,
 &#39;zip_code&#39;: &#39;48823&#39;}
</pre></div>
</div>
</div>
</div>
</section>
<section id="kompozycja-transformacji-w-jedna">
<h4>Kompozycja transformacji w jedną<a class="headerlink" href="#kompozycja-transformacji-w-jedna" title="Permalink to this headline">#</a></h4>
<p>Zamiast ręcznie pisać pętle możemy do przetwarzenia kilku kolumn, możemy je złożyć w jedną transformację za pomocą klasy <a class="reference external" href="https://riverml.xyz/0.14.0/api/compose/TransformerUnion/"><code class="docutils literal notranslate"><span class="pre">TransformerUnion</span></code></a>. W tym calu musimy jednak mieć naszą metodę transformującą dane z wykorzystaniem klasy <a class="reference external" href="https://riverml.xyz/0.14.0/api/compose/FuncTransformer/"><code class="docutils literal notranslate"><span class="pre">FuncTransformer</span></code></a>.</p>
<p>Zaczniemy od przepisania transformacji w klasę.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span>


<span class="k">class</span> <span class="nc">TimestamptoDateConverter</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col_name</span> <span class="o">=</span> <span class="n">col_name</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]:</span>
        <span class="c1"># Do not assume incorrectly that something is a date in timestamp format</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="si">}</span><span class="s2">_datetime&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">col_name</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e9</span>
            <span class="p">)</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Teraz możemy utworzyć obiekt <code class="docutils literal notranslate"><span class="pre">FuncTransformer</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">river.compose</span> <span class="kn">import</span> <span class="n">FuncTransformer</span>

<span class="n">FuncTransformer</span><span class="p">(</span><span class="n">TimestamptoDateConverter</span><span class="p">(</span><span class="n">col_name</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FuncTransformer (
  func=&lt;__main__.TimestamptoDateConverter object at 0x2862de5b0&gt;
)
</pre></div>
</div>
</div>
</div>
<p>Teraz możemy złożyć transformację kilku cech za tworząc obiekt klasy <a class="reference external" href="https://riverml.xyz/0.14.0/api/compose/TransformerUnion/"><code class="docutils literal notranslate"><span class="pre">TransformerUnion</span></code></a> lub użyć operatora <code class="docutils literal notranslate"><span class="pre">+</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">river.compose</span> <span class="kn">import</span> <span class="n">TransformerUnion</span>

<span class="n">transformations</span> <span class="o">=</span> <span class="n">TransformerUnion</span><span class="p">(</span>
    <span class="n">FuncTransformer</span><span class="p">(</span><span class="n">TimestamptoDateConverter</span><span class="p">(</span><span class="n">col_name</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)),</span>
    <span class="n">FuncTransformer</span><span class="p">(</span><span class="n">TimestamptoDateConverter</span><span class="p">(</span><span class="n">col_name</span><span class="o">=</span><span class="s2">&quot;release_date&quot;</span><span class="p">)),</span>
<span class="p">)</span>
<span class="n">transformations</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TransformerUnion (
  FuncTransformer (
    func=&lt;__main__.TimestamptoDateConverter object at 0x2862f2640&gt;
  ),
  FuncTransformer (
    func=&lt;__main__.TimestamptoDateConverter object at 0x2862f26d0&gt;
  )
)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transformations</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">FuncTransformer</span><span class="p">(</span><span class="n">TimestamptoDateConverter</span><span class="p">(</span><span class="n">col_name</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">FuncTransformer</span><span class="p">(</span><span class="n">TimestamptoDateConverter</span><span class="p">(</span><span class="n">col_name</span><span class="o">=</span><span class="s2">&quot;release_date&quot;</span><span class="p">)),</span>
<span class="p">)</span>
<span class="n">transformations</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(TransformerUnion (
   FuncTransformer (
     func=&lt;__main__.TimestamptoDateConverter object at 0x2862f2b20&gt;
   ),
   FuncTransformer (
     func=&lt;__main__.TimestamptoDateConverter object at 0x2862f26a0&gt;
   )
 ),)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transformations</span> <span class="o">=</span> <span class="n">TransformerUnion</span><span class="p">(</span>
    <span class="n">FuncTransformer</span><span class="p">(</span><span class="n">TimestamptoDateConverter</span><span class="p">(</span><span class="n">col_name</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)),</span>
    <span class="n">FuncTransformer</span><span class="p">(</span><span class="n">TimestamptoDateConverter</span><span class="p">(</span><span class="n">col_name</span><span class="o">=</span><span class="s2">&quot;release_date&quot;</span><span class="p">)),</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">x</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">transformations</span><span class="o">.</span><span class="n">learn_one</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">transform_one</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="n">display_pretty</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;user&#39;: 259,
 &#39;item&#39;: 286,
 &#39;rating&#39;: 4.0,
 &#39;timestamp&#39;: 874731927000000000,
 &#39;title&#39;: &#39;English Patient, The (1996)&#39;,
 &#39;release_date&#39;: 848016000000000000,
 &#39;genres&#39;: &#39;drama, romance, war&#39;,
 &#39;age&#39;: 21,
 &#39;gender&#39;: &#39;M&#39;,
 &#39;occupation&#39;: &#39;student&#39;,
 &#39;zip_code&#39;: &#39;48823&#39;,
 &#39;release_date_datetime&#39;: datetime.datetime(1996, 11, 15, 1, 0),
 &#39;timestamp_datetime&#39;: datetime.datetime(1997, 9, 20, 7, 5, 27)}
</pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Zamiast nadpisywać obiekty w powyższym kodzie, dodano nowe kolumny.
To jak zostanie to obsłużone jest po naszej stronie. W niektórych przypadkach źródłowe kolumny usuwa się dopiero na końcu, ponieważ mogą być wymagane do transformacji innych cech.</p>
</div>
</section>
<section id="modelowanie-tematyczne-tytulow-filmow-za-pomoca-algorytmu-lda">
<h4>Modelowanie tematyczne tytułów filmów za pomocą algorytmu <code class="docutils literal notranslate"><span class="pre">LDA</span></code><a class="headerlink" href="#modelowanie-tematyczne-tytulow-filmow-za-pomoca-algorytmu-lda" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">river.feature_extraction</span> <span class="kn">import</span> <span class="n">BagOfWords</span>
<span class="kn">from</span> <span class="nn">river.preprocessing</span> <span class="kn">import</span> <span class="n">LDA</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">iter_pandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>

<span class="n">bow</span> <span class="o">=</span> <span class="n">BagOfWords</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
<span class="n">lda</span> <span class="o">=</span> <span class="n">LDA</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">441</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">bow_title</span> <span class="o">=</span> <span class="n">bow</span><span class="o">.</span><span class="n">transform_one</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># `break` i `display_pretty` tylko w celach wyświetlenia pojedynczego rekordu</span>
    <span class="n">display_pretty</span><span class="p">(</span><span class="n">lda</span><span class="o">.</span><span class="n">learn_transform_one</span><span class="p">(</span><span class="n">bow_title</span><span class="p">))</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{0: 0.5,
 1: 1.5,
 2: 0.5,
 3: 2.5,
 4: 0.5,
 5: 1.5,
 6: 0.5,
 7: 0.5,
 8: 1.5,
 9: 0.5}
</pre></div>
</div>
</div>
</div>
</section>
<section id="tworzenie-sekwencji-krokow-przetwarzania-za-pomoca-klasy-pipeline">
<h4>Tworzenie sekwencji kroków przetwarzania za pomocą klasy <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code><a class="headerlink" href="#tworzenie-sekwencji-krokow-przetwarzania-za-pomoca-klasy-pipeline" title="Permalink to this headline">#</a></h4>
<p>Przekształcimy teraz LDA w jeden pipeline. Możemy to zrobić wykorzystując operator <code class="docutils literal notranslate"><span class="pre">|</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">BagOfWords</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s2">&quot;title&quot;</span><span class="p">)</span> <span class="o">|</span> <span class="n">LDA</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">441</span><span class="p">)</span>
<span class="n">pipe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><div class="river-component river-pipeline"><details class="river-component river-estimator"><summary class="river-summary"><pre class="river-estimator-name">BagOfWords</pre></summary><code class="river-estimator-params">(
  on="title"
  strip_accents=True
  lowercase=True
  preprocessor=None
  stop_words=None
  tokenizer_pattern="(?u)\b\w[\w\-]+\b"
  tokenizer=None
  ngram_range=(1, 1)
)

</code></details><details class="river-component river-estimator"><summary class="river-summary"><pre class="river-estimator-name">LDA</pre></summary><code class="river-estimator-params">(
  n_components=10
  number_of_documents=1e+06
  alpha_theta=0.5
  alpha_beta=100.
  tau=64.
  kappa=0.75
  vocab_prune_interval=10
  number_of_samples=10
  ranking_smooth_factor=1e-12
  burn_in_sweeps=5
  maximum_size_vocabulary=4000
  seed=441
)

</code></details></div><style scoped>
.river-estimator {
    padding: 1em;
    border-style: solid;
    background: white;
}

.river-pipeline {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: linear-gradient(#000, #000) no-repeat center / 3px 100%;
}

.river-union {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    padding: 1em;
    border-style: solid;
    background: white;
}

.river-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 1em;
    border-style: solid;
    background: white;
}

.river-wrapper > .river-estimator {
    margin-top: 1em;
}

/* Vertical spacing between steps */

.river-component + .river-component {
    margin-top: 2em;
}

.river-union > .river-estimator {
    margin-top: 0;
}

.river-union > .pipeline {
    margin-top: 0;
}

/* Spacing within a union of estimators */

.river-union > .river-component + .river-component {
    margin-left: 1em;
}

/* Typography */

.river-estimator-params {
    display: block;
    white-space: pre-wrap;
    font-size: 120%;
    margin-bottom: -1em;
}

.river-estimator > .river-estimator-params,
.river-wrapper > .river-details > river-estimator-params {
    background-color: white !important;
}

.river-estimator-name {
    display: inline;
    margin: 0;
    font-size: 130%;
}

/* Toggle */

.river-summary {
    display: flex;
    align-items:center;
    cursor: pointer;
}

.river-summary > div {
    width: 100%;
}
</style></div></div></div>
</div>
<p>lub możemy bezpośrednio utworzyć obiekt klasy <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">river.compose.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">BagOfWords</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s2">&quot;title&quot;</span><span class="p">),</span> <span class="n">LDA</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">441</span><span class="p">))</span>
<span class="n">pipe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><div class="river-component river-pipeline"><details class="river-component river-estimator"><summary class="river-summary"><pre class="river-estimator-name">BagOfWords</pre></summary><code class="river-estimator-params">(
  on="title"
  strip_accents=True
  lowercase=True
  preprocessor=None
  stop_words=None
  tokenizer_pattern="(?u)\b\w[\w\-]+\b"
  tokenizer=None
  ngram_range=(1, 1)
)

</code></details><details class="river-component river-estimator"><summary class="river-summary"><pre class="river-estimator-name">LDA</pre></summary><code class="river-estimator-params">(
  n_components=10
  number_of_documents=1e+06
  alpha_theta=0.5
  alpha_beta=100.
  tau=64.
  kappa=0.75
  vocab_prune_interval=10
  number_of_samples=10
  ranking_smooth_factor=1e-12
  burn_in_sweeps=5
  maximum_size_vocabulary=4000
  seed=441
)

</code></details></div><style scoped>
.river-estimator {
    padding: 1em;
    border-style: solid;
    background: white;
}

.river-pipeline {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: linear-gradient(#000, #000) no-repeat center / 3px 100%;
}

.river-union {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    padding: 1em;
    border-style: solid;
    background: white;
}

.river-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 1em;
    border-style: solid;
    background: white;
}

.river-wrapper > .river-estimator {
    margin-top: 1em;
}

/* Vertical spacing between steps */

.river-component + .river-component {
    margin-top: 2em;
}

.river-union > .river-estimator {
    margin-top: 0;
}

.river-union > .pipeline {
    margin-top: 0;
}

/* Spacing within a union of estimators */

.river-union > .river-component + .river-component {
    margin-left: 1em;
}

/* Typography */

.river-estimator-params {
    display: block;
    white-space: pre-wrap;
    font-size: 120%;
    margin-bottom: -1em;
}

.river-estimator > .river-estimator-params,
.river-wrapper > .river-details > river-estimator-params {
    background-color: white !important;
}

.river-estimator-name {
    display: inline;
    margin: 0;
    font-size: 130%;
}

/* Toggle */

.river-summary {
    display: flex;
    align-items:center;
    cursor: pointer;
}

.river-summary > div {
    width: 100%;
}
</style></div></div></div>
</div>
<p>Co uproszcza cały kod do następującej postaci:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">BagOfWords</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s2">&quot;title&quot;</span><span class="p">),</span> <span class="n">LDA</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">441</span><span class="p">))</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">iter_pandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
    <span class="c1"># `break` i `display_pretty` tylko w celach wyświetlenia pojedynczego rekordu</span>
    <span class="n">display_pretty</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">learn_one</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">transform_one</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{0: 0.5,
 1: 1.5,
 2: 1.5,
 3: 0.5,
 4: 1.5,
 5: 0.5,
 6: 1.5,
 7: 0.5,
 8: 0.5,
 9: 1.5}
</pre></div>
</div>
</div>
</div>
</section>
<section id="agregacje-cech-z-perspektywy-danego-uzytkownika">
<h4>Agregacje cech z perspektywy danego użytkownika<a class="headerlink" href="#agregacje-cech-z-perspektywy-danego-uzytkownika" title="Permalink to this headline">#</a></h4>
<p>Aggregacje na strumieniu w bibliotece river wykonujemy za pomocą modułu <a class="reference external" href="https://riverml.xyz/0.14.0/api/feature-extraction/Agg/">Agg</a></p>
<p>W ramach materiałów skupimy się na aggregacji zmiennej wyjściowej czyli oceny filmu. Wym celu wykorzystamy klasę <a class="reference external" href="https://riverml.xyz/0.14.0/api/feature-extraction/TargetAgg/"><code class="docutils literal notranslate"><span class="pre">TargetAgg</span></code></a>, która dokonuje aggrecji cechy wyjściowej.</p>
<p>Obliczmy teraz liczbę recenzji użytkowników dla pierwszych dwudziestu elementów strumienia</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">river.feature_extraction</span> <span class="kn">import</span> <span class="n">TargetAgg</span>
<span class="kn">from</span> <span class="nn">river.stats</span> <span class="kn">import</span> <span class="n">Count</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">iter_pandas</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>

<span class="n">agg</span> <span class="o">=</span> <span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="n">Count</span><span class="p">())</span>
<span class="n">users_reviews_count</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">users_reviews_count</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">agg</span><span class="o">.</span><span class="n">learn_one</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">transform_one</span><span class="p">(</span><span class="n">x</span><span class="p">)})</span>
    
<span class="n">users_reviews_count_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">users_reviews_count</span><span class="p">)</span>
<span class="n">users_reviews_count_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;event_id&quot;</span>
<span class="n">users_reviews_count_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>y_count_by_user</th>
    </tr>
    <tr>
      <th>event_id</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>259</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>259</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>259</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>259</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>259</td>
      <td>5</td>
    </tr>
    <tr>
      <th>5</th>
      <td>259</td>
      <td>6</td>
    </tr>
    <tr>
      <th>6</th>
      <td>259</td>
      <td>7</td>
    </tr>
    <tr>
      <th>7</th>
      <td>259</td>
      <td>8</td>
    </tr>
    <tr>
      <th>8</th>
      <td>259</td>
      <td>9</td>
    </tr>
    <tr>
      <th>9</th>
      <td>259</td>
      <td>10</td>
    </tr>
    <tr>
      <th>10</th>
      <td>259</td>
      <td>11</td>
    </tr>
    <tr>
      <th>11</th>
      <td>259</td>
      <td>12</td>
    </tr>
    <tr>
      <th>12</th>
      <td>259</td>
      <td>13</td>
    </tr>
    <tr>
      <th>13</th>
      <td>259</td>
      <td>14</td>
    </tr>
    <tr>
      <th>14</th>
      <td>259</td>
      <td>15</td>
    </tr>
    <tr>
      <th>15</th>
      <td>259</td>
      <td>16</td>
    </tr>
    <tr>
      <th>16</th>
      <td>851</td>
      <td>1</td>
    </tr>
    <tr>
      <th>17</th>
      <td>851</td>
      <td>2</td>
    </tr>
    <tr>
      <th>18</th>
      <td>851</td>
      <td>3</td>
    </tr>
    <tr>
      <th>19</th>
      <td>851</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Aggregacje cechy z perspektywy całej historii użytkownika to tylko jedna z możliwości. Możemy zostosować aggregacje typu <a class="reference external" href="https://riverml.xyz/0.14.0/api/utils/Rolling/"><code class="docutils literal notranslate"><span class="pre">Rolling</span></code></a> która dokona aggregacji tylko na określonej liczbie rekordów.</p>
<p>Obliczmy teraz średnia ocena recenzji użytkownika z ostatnich pięciu rekordów</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">river.utils</span> <span class="kn">import</span> <span class="n">Rolling</span>
<span class="kn">from</span> <span class="nn">river.stats</span> <span class="kn">import</span> <span class="n">Mean</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">iter_pandas</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>

<span class="n">agg</span> <span class="o">=</span> <span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="n">Rolling</span><span class="p">(</span><span class="n">Mean</span><span class="p">(),</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">user_rolling_review_mean</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">user_rolling_review_mean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">],</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">agg</span><span class="o">.</span><span class="n">learn_one</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">transform_one</span><span class="p">(</span><span class="n">x</span><span class="p">)}</span>
    <span class="p">)</span>

<span class="n">user_rolling_review_mean_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">user_rolling_review_mean</span><span class="p">)</span>
<span class="n">user_rolling_review_mean_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;event_id&quot;</span>
<span class="n">user_rolling_review_mean_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>rating</th>
      <th>y_mean_by_user</th>
    </tr>
    <tr>
      <th>event_id</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>259</td>
      <td>4.0</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>259</td>
      <td>4.0</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>259</td>
      <td>4.0</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>259</td>
      <td>4.0</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>259</td>
      <td>4.0</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>259</td>
      <td>4.0</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>259</td>
      <td>4.0</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>259</td>
      <td>3.0</td>
      <td>3.800000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>259</td>
      <td>4.0</td>
      <td>3.800000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>259</td>
      <td>4.0</td>
      <td>3.800000</td>
    </tr>
    <tr>
      <th>10</th>
      <td>259</td>
      <td>4.0</td>
      <td>3.800000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>259</td>
      <td>3.0</td>
      <td>3.600000</td>
    </tr>
    <tr>
      <th>12</th>
      <td>259</td>
      <td>3.0</td>
      <td>3.600000</td>
    </tr>
    <tr>
      <th>13</th>
      <td>259</td>
      <td>4.0</td>
      <td>3.600000</td>
    </tr>
    <tr>
      <th>14</th>
      <td>259</td>
      <td>5.0</td>
      <td>3.800000</td>
    </tr>
    <tr>
      <th>15</th>
      <td>259</td>
      <td>4.0</td>
      <td>3.800000</td>
    </tr>
    <tr>
      <th>16</th>
      <td>851</td>
      <td>2.0</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>17</th>
      <td>851</td>
      <td>3.0</td>
      <td>2.500000</td>
    </tr>
    <tr>
      <th>18</th>
      <td>851</td>
      <td>3.0</td>
      <td>2.666667</td>
    </tr>
    <tr>
      <th>19</th>
      <td>851</td>
      <td>5.0</td>
      <td>3.250000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Aggregacje również możemy grupować w pipeline za pomocą <code class="docutils literal notranslate"><span class="pre">TransformerUnion</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aggregations</span> <span class="o">=</span> <span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="n">Rolling</span><span class="p">(</span><span class="n">Mean</span><span class="p">(),</span> <span class="mi">5</span><span class="p">))</span> <span class="o">+</span>  <span class="n">TargetAgg</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="n">Count</span><span class="p">())</span>
<span class="n">aggregations</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TransformerUnion (
  TargetAgg (
    by=[&#39;user&#39;]
    how=Rolling (
      obj=Mean ()
      window_size=5
    )
    target_name=&quot;y&quot;
  ),
  TargetAgg (
    by=[&#39;user&#39;]
    how=Count ()
    target_name=&quot;y&quot;
  )
)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">iter_pandas</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>

<span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">],</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">aggregations</span><span class="o">.</span><span class="n">learn_one</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">transform_one</span><span class="p">(</span><span class="n">x</span><span class="p">)})</span>
    
<span class="n">output</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="n">output</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;event_id&quot;</span>
<span class="n">output</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>rating</th>
      <th>y_count_by_user</th>
      <th>y_mean_by_user</th>
    </tr>
    <tr>
      <th>event_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>259</td>
      <td>4.0</td>
      <td>1</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>259</td>
      <td>4.0</td>
      <td>2</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>259</td>
      <td>4.0</td>
      <td>3</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>259</td>
      <td>4.0</td>
      <td>4</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>259</td>
      <td>4.0</td>
      <td>5</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>259</td>
      <td>4.0</td>
      <td>6</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>259</td>
      <td>4.0</td>
      <td>7</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>259</td>
      <td>3.0</td>
      <td>8</td>
      <td>3.800000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>259</td>
      <td>4.0</td>
      <td>9</td>
      <td>3.800000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>259</td>
      <td>4.0</td>
      <td>10</td>
      <td>3.800000</td>
    </tr>
    <tr>
      <th>10</th>
      <td>259</td>
      <td>4.0</td>
      <td>11</td>
      <td>3.800000</td>
    </tr>
    <tr>
      <th>11</th>
      <td>259</td>
      <td>3.0</td>
      <td>12</td>
      <td>3.600000</td>
    </tr>
    <tr>
      <th>12</th>
      <td>259</td>
      <td>3.0</td>
      <td>13</td>
      <td>3.600000</td>
    </tr>
    <tr>
      <th>13</th>
      <td>259</td>
      <td>4.0</td>
      <td>14</td>
      <td>3.600000</td>
    </tr>
    <tr>
      <th>14</th>
      <td>259</td>
      <td>5.0</td>
      <td>15</td>
      <td>3.800000</td>
    </tr>
    <tr>
      <th>15</th>
      <td>259</td>
      <td>4.0</td>
      <td>16</td>
      <td>3.800000</td>
    </tr>
    <tr>
      <th>16</th>
      <td>851</td>
      <td>2.0</td>
      <td>1</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>17</th>
      <td>851</td>
      <td>3.0</td>
      <td>2</td>
      <td>2.500000</td>
    </tr>
    <tr>
      <th>18</th>
      <td>851</td>
      <td>3.0</td>
      <td>3</td>
      <td>2.666667</td>
    </tr>
    <tr>
      <th>19</th>
      <td>851</td>
      <td>5.0</td>
      <td>4</td>
      <td>3.250000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./labs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="networks.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Sieci - analiza i modelowanie</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="concept_drift.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Wykrywanie dryftu konceptu</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Mateusz Nurek, Kamil Tagowski, Radosław Michalski, Piotr Bródka<br/>
  
      &copy; Copyright 2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>